{% extends 'base.html' %}
{% load static %}

{% block title %}Dars: {{ lesson.title }} | GEEKS CRM{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">
    <!-- Header Card -->
    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
        <div class="flex flex-col sm:flex-row items-center sm:items-start justify-between gap-4">
            <div class="flex-1 text-center sm:text-left">
                <p class="text-blue-100 text-sm mb-2">
                    <i class="fas fa-calendar"></i> {{ lesson.date|date:"d.m.Y" }}
                    {% if lesson.start_time %}
                    <span class="ml-3"><i class="fas fa-clock"></i> {{ lesson.start_time|time:"H:i" }}
                    {% if lesson.end_time %} - {{ lesson.end_time|time:"H:i" }}{% endif %}</span>
                    {% endif %}
                </p>
                <h1 class="text-3xl font-bold mb-3">{{ lesson.title|default:"Dars" }}</h1>
                <div class="flex flex-wrap items-center justify-center sm:justify-start gap-4 text-sm">
                    <a href="{% url 'courses:group_detail' lesson.group.pk %}" 
                       class="flex items-center gap-2 bg-white bg-opacity-20 px-4 py-2 rounded-lg backdrop-blur-sm hover:bg-opacity-30 transition">
                        <i class="fas fa-users"></i>
                        <span class="font-semibold">{{ lesson.group.name }}</span>
                    </a>
                    {% if lesson.group.room %}
                    <span class="flex items-center gap-2 bg-white bg-opacity-20 px-4 py-2 rounded-lg backdrop-blur-sm">
                        <i class="fas fa-door-open"></i>
                        <span class="font-semibold">{{ lesson.group.room.name }}</span>
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left Column (2/3) -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Topic Section -->
            {% if lesson.topic %}
            <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100">
                <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <i class="fas fa-book text-blue-600"></i>
                    Mavzu
                </h2>
                <div class="space-y-3">
                    <div>
                        <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-1">Mavzu nomi</p>
                        <p class="text-lg font-bold text-gray-900">{{ lesson.topic.name }}</p>
                    </div>
                    {% if lesson.topic.description %}
                    <div>
                        <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-1">Tavsif</p>
                        <p class="text-gray-700 leading-relaxed">{{ lesson.topic.description }}</p>
                    </div>
                    {% endif %}
                    {% if lesson.topic.duration_minutes %}
                    <div>
                        <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-1">Davomiyligi</p>
                        <p class="text-gray-700">{{ lesson.topic.duration_minutes }} daqiqa</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Topic Covered -->
            {% if lesson.topic_covered %}
            <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100">
                <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <i class="fas fa-check-circle text-green-600"></i>
                    O'tilgan mavzu
                </h2>
                <p class="text-gray-700 leading-relaxed">{{ lesson.topic_covered }}</p>
            </div>
            {% endif %}

            <!-- Notes -->
            {% if lesson.notes %}
            <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100">
                <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <i class="fas fa-sticky-note text-yellow-600"></i>
                    Qo'shimcha eslatmalar
                </h2>
                <p class="text-gray-700 leading-relaxed whitespace-pre-line">{{ lesson.notes }}</p>
            </div>
            {% endif %}
        </div>

        <!-- Right Column (1/3) -->
        <div class="space-y-6">
            <!-- Quick Info -->
            <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100">
                <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <i class="fas fa-info-circle text-blue-600"></i>
                    Ma'lumotlar
                </h2>
                <dl class="space-y-3 text-sm">
                    <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                        <dt class="text-gray-600">Guruh</dt>
                        <dd class="font-semibold text-gray-900">
                            <a href="{% url 'courses:group_detail' lesson.group.pk %}" 
                               class="text-blue-600 hover:text-blue-800">
                                {{ lesson.group.name }}
                            </a>
                        </dd>
                    </div>
                    <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                        <dt class="text-gray-600">Kurs</dt>
                        <dd class="font-semibold text-gray-900">
                            <a href="{% url 'courses:course_detail' lesson.group.course.pk %}" 
                               class="text-blue-600 hover:text-blue-800">
                                {{ lesson.group.course.name }}
                            </a>
                        </dd>
                    </div>
                    {% if lesson.group.room %}
                    <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                        <dt class="text-gray-600">Xona</dt>
                        <dd class="font-semibold text-gray-900">{{ lesson.group.room.name }}</dd>
                    </div>
                    {% endif %}
                    <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                        <dt class="text-gray-600">Sana</dt>
                        <dd class="font-semibold text-gray-900">{{ lesson.date|date:"d.m.Y" }}</dd>
                    </div>
                    {% if lesson.start_time %}
                    <div class="flex justify-between items-center">
                        <dt class="text-gray-600">Vaqt</dt>
                        <dd class="font-semibold text-gray-900">
                            {{ lesson.start_time|time:"H:i" }}
                            {% if lesson.end_time %} - {{ lesson.end_time|time:"H:i" }}{% endif %}
                        </dd>
                    </div>
                    {% endif %}
                </dl>
            </div>

            <!-- Quick Actions -->
            <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100">
                <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <i class="fas fa-bolt text-yellow-500"></i>
                    Tez harakatlar
                </h2>
                <div class="space-y-2">
                    <a href="{% url 'courses:group_detail' lesson.group.pk %}" 
                       class="block w-full px-4 py-2.5 bg-blue-50 border-2 border-blue-200 rounded-lg hover:bg-blue-100 transition text-sm font-semibold text-blue-700 flex items-center gap-2">
                        <i class="fas fa-users"></i>
                        <span>Guruhni ko'rish</span>
                    </a>
                    <a href="{% url 'attendance:group_attendance' lesson.group.pk %}" 
                       class="block w-full px-4 py-2.5 bg-green-50 border-2 border-green-200 rounded-lg hover:bg-green-100 transition text-sm font-semibold text-green-700 flex items-center gap-2">
                        <i class="fas fa-calendar-check"></i>
                        <span>Davomat</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
