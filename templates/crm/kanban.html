{% extends 'base.html' %}

{% block title %}CRM Kanban Board{% endblock %}

{% block content %}
<div class="mb-6">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-bold text-slate-800">Kanban Board</h1>
            <p class="text-slate-600">Jami: {{ total_leads }} ta lid</p>
        </div>
        <div class="flex gap-3">
            <a href="{% url 'crm:lead_table' %}" class="px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300">
                <i class="fas fa-table mr-2"></i>Jadval
            </a>
            <a href="{% url 'crm:lead_create' %}" class="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700">
                <i class="fas fa-plus mr-2"></i>Yangi lid
            </a>
        </div>
    </div>
</div>

<!-- Kanban Board -->
<div class="flex gap-4 overflow-x-auto pb-4" style="min-height: 70vh;">
    {% for item in kanban_data %}
    <div class="flex-shrink-0 w-80 bg-slate-100 rounded-lg">
        <!-- Status Header -->
        <div class="p-3 border-b border-slate-200 sticky top-0 bg-slate-100 rounded-t-lg">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full" style="background-color: {{ item.status.color }}"></span>
                    <h3 class="font-semibold text-slate-700">{{ item.status.name }}</h3>
                </div>
                <span class="px-2 py-1 bg-slate-200 text-slate-600 text-sm rounded-full">{{ item.count }}</span>
            </div>
        </div>
        
        <!-- Cards -->
        <div class="p-3 space-y-3 max-h-[60vh] overflow-y-auto">
            {% for lead in item.leads %}
            <a href="{% url 'crm:lead_detail' lead.pk %}" 
               class="block bg-white rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow border border-slate-200">
                <div class="flex justify-between items-start mb-2">
                    <h4 class="font-medium text-slate-800">{{ lead.name }}</h4>
                    <span class="text-xs px-2 py-1 rounded-full 
                        {% if lead.source == 'instagram' %}bg-pink-100 text-pink-700
                        {% elif lead.source == 'telegram' %}bg-blue-100 text-blue-700
                        {% elif lead.source == 'google_sheets' %}bg-green-100 text-green-700
                        {% else %}bg-slate-100 text-slate-600{% endif %}">
                        {{ lead.get_source_display }}
                    </span>
                </div>
                <p class="text-sm text-slate-600 mb-2">
                    <i class="fas fa-phone mr-1"></i>{{ lead.phone }}
                </p>
                {% if lead.interested_course %}
                <p class="text-xs text-slate-500 mb-2">
                    <i class="fas fa-book mr-1"></i>{{ lead.interested_course.name }}
                </p>
                {% endif %}
                <div class="flex justify-between items-center text-xs text-slate-400">
                    <span>
                        {% if lead.assigned_sales %}
                        <i class="fas fa-user mr-1"></i>{{ lead.assigned_sales.username }}
                        {% else %}
                        <span class="text-orange-500">Biriktirilmagan</span>
                        {% endif %}
                    </span>
                    <span>{{ lead.days_in_status }} kun</span>
                </div>
            </a>
            {% empty %}
            <p class="text-center text-slate-400 py-4">Lidlar yo'q</p>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

